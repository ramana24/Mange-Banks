/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/bankmaster/manage/util/BaseController","fin/cash/bankmaster/manage/util/Navigator","fin/cash/bankmaster/manage/util/Formatter"],function(B,N,F){"use strict";return B.extend("fin.cash.bankmaster.manage.controller.manageExistingBanks",{formatter:F,onInit:function(e){this.getRouter().attachRoutePatternMatched(this.onRoutePatternMatched,this);},onRoutePatternMatched:function(e){if(e.getParameter("name")!=="selectExistingBanksScreen"){return;}var t=this.getText("SELECT_EXISTING_BANKS_SCREEN_TITLE");this.getOwnerComponent().getService("ShellUIService").then(function(s){s.setTitle(t);},function(E){jQuery.sap.log.error("Cannot get ShellUIService",E,"fin.cash.bankmaster.manage.Component");});this.bpNumber=e.getParameter("arguments").bpNumber;this.bankCountry=e.getParameter("arguments").bankCountry;this.bankInternalId=e.getParameter("arguments").bankInternalId;this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.bankSmartResponsiveTable").setTableBindingPath("/BankSet");this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.bankSmartResponsiveTable").rebindTable();var m=this.getView().getModel();m.setDefaultBindingMode("TwoWay");},onSearchButtonPressed:function(e){var s=e.getSource().getValue();var o=this.bankSelect.split(",");var f=[];var b=this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.bankSmartResponsiveTable");if(s!=null&&s.length>0){var f=[];for(var i in o){f.push(new sap.ui.model.Filter(o[i],sap.ui.model.FilterOperator.Contains,s));}b.getTable().getBinding("items").filter([new sap.ui.model.Filter(f,false)]);}else{b.getTable().getBinding("items").filter();}},onBeforeRebindExistingBanksTable:function(e){var b=e.getParameter("bindingParams");var a=this.getView().getModel().createEntry("/BankSet",{}).getProperty();this.bankSelect=b.parameters.select;var s="";for(var i in a){if(i!=="__metadata"){if(s){s+=","+i;}else{s=i;}}}if(s){b.parameters.select=s;}if(!b.filters){b.filters=[];}b.filters.push(new sap.ui.model.Filter("BpNumber",sap.ui.model.FilterOperator.NE,this.bpNumber));b.parameters["countMode"]="Inline";},onCancelButtonPressed:function(e){N._navigateBack(this);},onSaveButtonPressed:function(e){var c=this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.bankSmartResponsiveTable").getTable().getSelectedContextPaths();var C=this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.bankSmartResponsiveTable").getTable().getSelectedContexts();for(var i in c){this.relatedBranches=false;var m=this.getView().getModel();m.setDefaultBindingMode("TwoWay");var b=m.createEntry("/RelatedBranchesSet",{});this.getView().setBindingContext(b);var d=this.getView().getBindingContext().getObject();d.RelatedBankCountry=C[i].getProperty().BankCountry;d.RelatedBankInternalId=C[i].getProperty().BankInternalId;d.BankCountry=this.bankCountry;var o=decodeURIComponent(this.bankInternalId);d.BankInternalId=o;d.BpNumber=this.bpNumber;var t=this;t.getView().getModel().create("/RelatedBranchesSet",jQuery.extend(false,{},d),{success:function(D,r){sap.m.MessageToast.show(t.getText("CREATE_RELATED_BRANCHES_SUCCESS_TEXT"));},error:function(D,r){sap.m.MessageToast.show(t.getText("CREATE_RELATED_BRANCHES_ERROR_TEXT"));}});}window.setTimeout(function(){N._navigateBack(this);},5000);},});});
