/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/bankmaster/manage/util/BaseController","fin/cash/bankmaster/manage/util/Creator","fin/cash/bankmaster/manage/util/Updater","fin/cash/bankmaster/manage/util/Navigator","fin/cash/bankmaster/manage/util/Messager","fin/cash/bankmaster/manage/util/Validator","fin/cash/bankmaster/manage/util/Formatter"],function(B,C,U,N,M,V,F){"use strict";return B.extend("fin.cash.bankmaster.manage.controller.DefaultableBP",{formatter:F,onInit:function(e){this.getRouter().attachRoutePatternMatched(this.onRoutePatternMatched,this);V._initMessagePopover(this);this.validatedFields=V._initValidatedFields();if(this.byId("messageIndicator")){this.byId("messagesIndicator").setVisible(false);}this.byId("DefaultableBPViewObjectPageLayout").setShowFooter(false);},onRoutePatternMatched:function(e){if(e.getParameter("name")!=="DefaultableBPScreen"){return;}this.getView().getModel().setDefaultBindingMode("TwoWay");var t=this.getText("DEFAULTABLE_BP");this.getOwnerComponent().getService("ShellUIService").then(function(s){s.setTitle(t);},function(E){jQuery.sap.log.error("Cannot get ShellUIService",E,"fin.cash.bankmaster.manage.Component");});this.mode=e.getParameter("arguments").mode.toLowerCase();this.defaultableBPPath=e.getParameter("arguments").defaultableBPPath;this.bankContextPath=e.getParameter("arguments").bankContextPath;this.bankContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.bankContextPath);this.byId("defaultableBPBankGroup").getModel().read("/"+this.bankContextPath);this.byId("defaultableBPBankGroup").setBindingContext(this.bankContext);if(this.mode==="create"){this.byId("fin.cash.bankmaster.manage.editButton").setVisible(false);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.defaultableBPSmartForm").setEditable(true);this.defaultableBPContext=this.getView().getModel().createEntry("/DefaultableBPSet");for(var i in this.defaultableBPContext.getProperty()){if(i!="__metadata"&&this.bankContext.getProperty()[i])this.defaultableBPContext.getProperty()[i]=this.bankContext.getProperty()[i];}this.byId("DefaultableBPViewObjectPageLayout").setShowFooter(true);}else{if(this.mode==="edit")this._toggleEditAndDisplay(true);else this._toggleEditAndDisplay(false);this.getView().getModel().read("/"+this.defaultableBPPath);this.defaultableBPContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.defaultableBPPath);}this.getView().setBindingContext(this.defaultableBPContext);},_toggleEditAndDisplay:function(e){this.byId("fin.cash.bankmaster.manage.editButton").setVisible(!e);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(e);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(e);this.byId("fin.cash.bankmaster.manage.defaultableBPSmartForm").setEditable(e);this.byId("DefaultableBPViewObjectPageLayout").setShowFooter(e);},onSaveButtonPressed:function(){this.dataObject=this.getView().getBindingContext().getObject();this.dataObject.BankInternalId=this.bankContext.getProperty("BankInternalId");this.dataObject.BankCountry=this.bankContext.getProperty("BankCountry");this.saveSuccess=false;this.validatedMessages=[];var i=4;var n=true;n=V._setNonEmptyValidation(this,"BusinessPartnerNo",this.getText("NON_EMPTY_VALIDATION_BUSINESS_PARTNER"))&&n;n=V._setNonEmptyValidation(this,"ValidFrom",this.getText("NON_EMPTY_VALIDATION_VALID_FROM"))&&n;n=V._setNonEmptyValidation(this,"ValidTo",this.getText("NON_EMPTY_VALIDATION_VALID_TO"))&&n;if(!n){return;}if(this.byId("ValidFrom").getValueState()==="Error"||this.byId("ValidTo").getValueState()==="Error"){return;}if(this.mode==="create"){this.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(false);this.byId("fin.cash.bankmaster.manage.saveButton").setText(this.getText("SAVING_BUTTON"));var t=this;$.when(C._createData(this,"/DefaultableBPSet",this.getText("CREATE_DEFAULTABLEBP_SUCCESS_TEXT"),this.getText("CREATE_DEFAULTABLEBP_ERROR_TEXT"))).then(function(r){if(r){t.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(true);t.byId("fin.cash.bankmaster.manage.saveButton").setText(t.getText("SAVE_BUTTON"));if(t.saveSuccess===true){var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-ddTkk:ss:mm"});var f=d.format(t.dataObject.ValidFrom,true).replace("T24","T00");t.getRouter().navTo("DefaultableBPScreen",{mode:"read",bankContextPath:t.bankContextPath,defaultableBPPath:"DefaultableBPSet(BankCountry='"+t.bankContext.getProperty("BankCountry")+"',BankInternalId='"+encodeURIComponent(t.bankContext.getProperty("BankInternalId"))+"',ValidFrom=datetime'"+encodeURIComponent(f)+"')"},true);}}});}else{U._updateData(this,this.getText("UPDATE_DEFAULTABLEBP_SUCCESS_TEXT"),this.getText("UPDATE_DEFAULTABLEBP_ERROR_TEXT"));this._toggleEditAndDisplay(false);}},onCancelButtonPressed:function(){M._pressCancelButton(this);},onEditButtonPressed:function(e){this._toggleEditAndDisplay(true);},onMessagePopoverPressed:function(){this.byId("messagesIndicator").setVisible(true);this.byId("messagesIndicator").setText(this.validatedMessages.length);this.messagePopover.openBy(this.byId("messagesIndicator"));},});});
