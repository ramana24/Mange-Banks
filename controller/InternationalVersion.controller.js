/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/bankmaster/manage/util/BaseController","fin/cash/bankmaster/manage/util/Creator","fin/cash/bankmaster/manage/util/Updater","fin/cash/bankmaster/manage/util/Navigator","fin/cash/bankmaster/manage/util/Messager","fin/cash/bankmaster/manage/util/Validator","fin/cash/bankmaster/manage/util/Layout"],function(B,C,U,N,M,V,L){"use strict";return B.extend("fin.cash.bankmaster.manage.controller.InternationalVersion",{onInit:function(e){this.getRouter().attachRoutePatternMatched(this.onRoutePatternMatched,this);V._initMessagePopover(this);this.validatedFields=V._initValidatedFields();this.byId("messagesIndicator").setVisible(false);this.byId("InternationalAddressViewObjectPageLayout").setShowFooter(false);},onRoutePatternMatched:function(e){if(e.getParameter("name")!=="InternationalVersionScreen")return;this.getView().getModel().setDefaultBindingMode("TwoWay");var t=this.getText("INTERNATIONAL_VERSION_OBJECT_HEADER_TITLE");this.getOwnerComponent().getService("ShellUIService").then(function(s){s.setTitle(t);},function(E){jQuery.sap.log.error("Cannot get ShellUIService",E,"fin.cash.bankmaster.manage.Component");});this.mode=e.getParameter("arguments").mode.toLowerCase();this.internationalVersionContextPath=e.getParameter("arguments").internationalVersionContextPath;this.bankContextPath=e.getParameter("arguments").bankContextPath;this.bankContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.bankContextPath);this.addressContextPath=e.getParameter("arguments").addressContextPath;this.addressContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.addressContextPath);if(this.mode==="create"){this.byId("fin.cash.bankmaster.manage.editButton").setVisible(false);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(true);this.byId("_IDEGen_fragment0--nationField").setEditable(true);this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.addressSmartForm").setEditable(true);this.internationalVersionContext=this.getView().getModel().createEntry("/AddressSet",{properties:this._prepareValuesInCreateMode()});this.byId("InternationalAddressViewObjectPageLayout").setShowFooter(true);}else{if(this.mode==="edit")this._toggleEditAndDisplay(true);else this._toggleEditAndDisplay(false);this.getView().getModel().read("/"+this.internationalVersionContextPath);this.internationalVersionContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.internationalVersionContextPath);}this.getView().setBindingContext(this.internationalVersionContext);},_prepareValuesInCreateMode:function(){var a=this.getView().getModel().getObject(this.addressContext.getPath());var e=["AddressCity","AddressGroup","AddressId","AddressLine1","AddressLine2","AddressLine3","AddressLine4","Building","CareOfName","Comments","County","District","Floor","HouseNumber","HouseNumberSupplement","Name","Name2","Name3","Name4","RoomNumber","SearchTerm1","SearchTerm2","Street","Title","TitleText","TownShip","Village"];e.forEach(function(i){a[i]="";});return a;},_toggleEditAndDisplay:function(s){if(s){this.mode="edit";this.byId("_IDEGen_fragment0--addressCountryField").setEditable(false);this.byId("_IDEGen_fragment0--nationField").setEditable(false);}else{this.mode="read";}this.byId("fin.cash.bankmaster.manage.editButton").setVisible(!s);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(s);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(s);this.byId("InternationalAddressViewObjectPageLayout").setShowFooter(s);this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.addressSmartForm").setEditable(s);},onSaveButtonPressed:function(e){this.dataObject=this.getView().getBindingContext().getObject();for(var i in this.getView().getModel().createEntry("/AddressSet").getProperty()){if(i!="__metadata"&&!this.dataObject[i]&&this.addressContext.getProperty()[i])this.dataObject[i]=this.addressContext.getProperty()[i];}this.saveSuccess=false;this.validatedMessages=[];if(this.mode==="create"){var n=true;n=V._setNonEmptyValidation(this,"_IDEGen_fragment0--addressCountryField",this.getText("NON_EMPTY_VALIDATION_BANK_COUNTRY_TITLE"))&&n;n=V._setNonEmptyValidation(this,"_IDEGen_fragment0--nationField",this.getText("NON_EMPTY_VALIDATION_INTERNATIONAL_VERSION_TITLE"))&&n;if(n===false)return;this.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(false);this.byId("fin.cash.bankmaster.manage.saveButton").setText(this.getText("SAVING_BUTTON"));var t=this;$.when(C._createData(this,"/AddressSet",this.getText("CREATE_INTERNATIONAL_SUCCESS_TEXT"),this.getText("CREATE_INTERNATIONAL_VERSION_ERROR_TEXT"))).then(function(r){if(r){t.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(true);t.byId("fin.cash.bankmaster.manage.saveButton").setText(t.getText("SAVE_BUTTON"));if(t.saveSuccess===true){t.getRouter().navTo("InternationalVersionScreen",{mode:"read",bankContextPath:t.bankContextPath,addressContextPath:t.addressContextPath,internationalVersionContextPath:"AddressSet(AddressId='"+t.bankContext.getProperty("AddressId")+"',Nation='"+t.getView().getBindingContext().getProperty("Nation")+"')"},true);}}});}else{U._updateData(this,this.getText("UPDATE_INTERNATIONAL_SUCCESS_TEXT"),this.getText("UPDATE_INTERNATIONAL_ERROR_TEXT"));this._toggleEditAndDisplay(false);}},onMessagePopoverPressed:function(){this.byId("messagesIndicator").setVisible(true);this.byId("messagesIndicator").setText(this.validatedMessages.length);this.messagePopover.openBy(this.byId("messagesIndicator"));},onCancelButtonPressed:function(){M._pressCancelButton(this);},onEditButtonPressed:function(e){this._toggleEditAndDisplay(true);},onToggleElements:function(){L._toggleElements(this);},});});
