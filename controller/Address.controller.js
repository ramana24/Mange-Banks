/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/bankmaster/manage/util/BaseController","fin/cash/bankmaster/manage/util/Creator","fin/cash/bankmaster/manage/util/Updater","fin/cash/bankmaster/manage/util/Deleter","fin/cash/bankmaster/manage/util/Navigator","fin/cash/bankmaster/manage/util/Messager","fin/cash/bankmaster/manage/util/Validator","fin/cash/bankmaster/manage/util/Formatter","fin/cash/bankmaster/manage/util/Layout"],function(B,C,U,D,N,M,V,F,L){"use strict";return B.extend("fin.cash.bankmaster.manage.controller.Address",{formatter:F,onInit:function(e){this.getRouter().attachRoutePatternMatched(this.onRoutePatternMatched,this);this.byId("_IDEGen_fragment0--nationGroupElement").setVisible(false);V._initMessagePopover(this);this.validatedFields=V._initValidatedFields();this.byId("messagesIndicator").setVisible(false);this.byId("AddressViewObjectPageLayout").setShowFooter(false);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());},onRoutePatternMatched:function(e){if(e.getParameter("name")!=="AddressScreen")return;this.getView().getModel().setDefaultBindingMode("TwoWay");var t=this.getText("ADVANCED_ADDRESS_SMARTFORM_TITLE");this.getOwnerComponent().getService("ShellUIService").then(function(s){s.setTitle(t);},function(E){jQuery.sap.log.error("Cannot get ShellUIService",E,"fin.cash.bankmaster.manage.Component");});this.mode=e.getParameter("arguments").mode.toLowerCase();this.addressContextPath=e.getParameter("arguments").addressContextPath;this.bankContextPath=e.getParameter("arguments").bankContextPath;this.bankContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.bankContextPath);this.bankCountry=this.bankContextPath.match(/BankCountry='(\S*)',/)[1];this.bankInternalId=this.bankContextPath.match(/BankInternalId='(\S*)'/)[1];if(this.mode==="create"){this.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").setVisible(false);this.byId("fin.cash.bankmaster.manage.editButton").setVisible(false);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(true);this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.addressSmartForm").setEditable(true);this.byId("AddressViewObjectPageLayout").setShowFooter(true);this.addressContext=this.getView().getModel().createEntry("/AddressSet",{});if(this.bankContext.getProperty()){for(var i in this.addressContext.getProperty()){if(i!=="__metadata"&&this.bankContext&&this.bankContext.getProperty()[i])this.addressContext.getProperty()[i]=this.bankContext.getProperty()[i];}}else{this.addressContext.getProperty()["BankCountry"]=this.bankCountry;var b=decodeURIComponent(this.bankInternalId);this.addressContext.getProperty()["BankInternalId"]=b;}}else{if(this.mode==="edit")this._toggleEditAndDisplay(true);else this._toggleEditAndDisplay(false);var a=this;this.getView().getModel().read("/F4_MultiKeySet",{success:function(d,r){if(d.results.length!==0){a.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").setVisible(true);a.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").setTableBindingPath("/"+a.bankContextPath+"/BankToAddressSet");a.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").rebindTable();}}});this.getView().getModel().read("/"+this.addressContextPath);this.addressContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.addressContextPath);}this.getView().setBindingContext(this.addressContext);},_toggleEditAndDisplay:function(s){if(s){this.mode="edit";this.byId("_IDEGen_fragment1--onInternationalVersionTableMode").setMode("MultiSelect");}else{this.mode="read";this.byId("_IDEGen_fragment1--onInternationalVersionTableMode").setMode();}this.byId("AddressViewObjectPageLayout").setShowFooter(s);this.byId("fin.cash.bankmaster.manage.editButton").setVisible(!s);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(s);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(s);this.byId("_IDEGen_fragment1--addInternationalVersionIcon").setEnabled(s);this.byId("_IDEGen_fragment1--deleteInternationalVersionIcon").setEnabled(s);this.byId("_IDEGen_fragment0--fin.cash.bankmaster.manage.addressSmartForm").setEditable(s);},onSaveButtonPressed:function(e){this.dataObject=this.getView().getBindingContext().getObject();for(var i in this.getView().getModel().createEntry("/AddressSet").getProperty()){if(i!=="__metadata"&&!this.dataObject[i]&&this.bankContext.getProperty()&&this.bankContext.getProperty()[i]){this.dataObject[i]=this.bankContext.getProperty()[i];}else if(i==="BankCountry"&&!this.dataObject[i]){this.dataObject[i]=this.bankCountry;}else if(i==="BankInternalId"&&!this.dataObject[i]){this.dataObject[i]=decodeURIComponent(this.bankInternalId);}}this.saveSuccess=false;this.validatedMessages=[];var t=this;if(this.mode==="create"){var n=true;n=V._setNonEmptyValidation(this,"_IDEGen_fragment0--addressCountryField",this.getText("NON_EMPTY_VALIDATION_BANK_COUNTRY_TITLE"))&&n;n=V._setLimitLength(this,"_IDEGen_fragment0--MobileNumber",this.getText("PHONE_NUMBER_VALIDATION_ERROR"),30)&&n;if(this.byId("_IDEGen_fragment0--MobileNumber").getValueState()==="Error"){n=false;}if(n===false)return;this.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(false);this.byId("fin.cash.bankmaster.manage.saveButton").setText(this.getText("SAVING_BUTTON"));$.when(C._createData(this,"/AddressSet",this.getText("CREATE_ADVANCED_ADDRESS_SUCCESS_TEXT"),this.getText("CREATE_ADVANCED_ADDRESS_ERROR_TEXT"))).then(function(r){if(r){t.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(true);t.byId("fin.cash.bankmaster.manage.saveButton").setText(t.getText("SAVE_BUTTON"));if(t.saveSuccess===true){t.getView().getModel().read("/"+t.bankContextPath,{success:function(d,R){if(t.saveSuccess===true){t.getRouter().navTo("AddressScreen",{bankContextPath:t.bankContextPath,addressContextPath:"AddressSet(AddressId='"+t.bankContext.getProperty("AddressId")+"',Nation='')",mode:"read"},true);}},error:function(d,R){}});}}});}else{if(this.byId("_IDEGen_fragment0--MobileNumber").getValueState()==="Error"){n=false;}if(n===false)return;U._updateData(this,this.getText("UPDATE_ADVANCED_ADDRESS_SUCCESS_TEXT"),this.getText("UPDATE_ADVANCED_ADDRESS_ERROR_TEXT")).then(function(r){if(r){if(t.saveSuccess===true){t._toggleEditAndDisplay(false);}else{t._toggleEditAndDisplay(true);}}});this.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").rebindTable();}},onMessagePopoverPressed:function(){this.byId("messagesIndicator").setVisible(true);this.byId("messagesIndicator").setText(this.validatedMessages.length);this.messagePopover.openBy(this.byId("messagesIndicator"));},onCancelButtonPressed:function(){M._pressCancelButton(this);},onEditButtonPressed:function(e){this._toggleEditAndDisplay(true);},onBeforeRebindInternationVersionTable:function(e){var b=e.getParameter("bindingParams");if(!b.filters){b.filters=[];}var f=new sap.ui.model.Filter("Nation",sap.ui.model.FilterOperator.NE,"");b.filters.push(f);var o=this.getView().getModel().createEntry("/AddressSet",{}).getProperty();for(var i in o){if(i!=="__metadata")b.parameters.select+=","+i;}b.parameters["countMode"]="Inline";this._filterTable(e);},_filterTable:function(e){if(this.bankCountry&&this.bankInternalId){var f=new sap.ui.model.Filter("BankCountry","EQ",this.bankCountry);var b=decodeURIComponent(this.bankInternalId);var o=new sap.ui.model.Filter("BankInternalId","EQ",b);var a=[f,o];e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter(a,true));}},onAddInternationalVersionPressed:function(e){this.getRouter().navTo("InternationalVersionScreen",{mode:"create",bankContextPath:this.bankContextPath,addressContextPath:this.addressContextPath,internationalVersionContextPath:"CreateEntitySet"},false);},onInternationVersionListItemPressed:function(e){this.getRouter().navTo("InternationalVersionScreen",{mode:this.mode,bankContextPath:this.bankContextPath,addressContextPath:this.addressContextPath,internationalVersionContextPath:e.getSource().getBindingContext().getPath().substr(1)},false);},onDeleteInternationalVersionIconPressed:function(e){var s=this.byId("_IDEGen_fragment1--fin.cash.bankmaster.manage.internationalVersionSmartResponsiveTable").getTable().getSelectedItems();var d=this.getText("DELETE_INTERNATIONAL_VERSION_SUCCESS_TEXT");var a=this.getText("DELETE_INTERNATIONAL_VERSION_ERROR_TEXT");var t=this;if(s.length===0){sap.m.MessageBox.warning(this.getText("DELETE_UNSELECTED_INTERNATIONAL_VERSION"));}else{sap.m.MessageBox.confirm(this.getText("DELETE_SELECTED_INTERNATIONAL_VERSION_TEXT"),{actions:[sap.m.MessageBox.Action.DELETE,sap.m.MessageBox.Action.CANCEL],onClose:function(A){if(A==="DELETE"){for(var i in s){D._deleteData(t,s[i].getBindingContextPath(),d,a);}}}});}},onMobileNumberChanged:function(e){var n=e.getParameters().newValue;if(n){var r=/^\d+$/;if(!r.test(n)){var m=this.getText("PHONE_NUMBER_VALIDATION_ERROR");this.byId("_IDEGen_fragment0--MobileNumber").setValueState("Error");this.byId("_IDEGen_fragment0--MonileNumber").setValueStateText(m);}}else{this.byId("_IDEGen_fragment0--MobileNumber").setValueState("None");}},onToggleElements:function(){L._toggleElements(this);}});});
