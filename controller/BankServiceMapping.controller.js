/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/bankmaster/manage/util/BaseController","fin/cash/bankmaster/manage/util/Creator","fin/cash/bankmaster/manage/util/Updater","fin/cash/bankmaster/manage/util/Navigator","fin/cash/bankmaster/manage/util/Messager","fin/cash/bankmaster/manage/util/Validator","fin/cash/bankmaster/manage/util/Formatter"],function(B,C,U,N,M,V,F){"use strict";return B.extend("fin.cash.bankmaster.manage.controller.BankServiceMapping",{formatter:F,onInit:function(e){this.getRouter().attachRoutePatternMatched(this.onRoutePatternMatched,this);V._initMessagePopover(this);this.validatedFields=V._initValidatedFields();if(this.byId("messagesIndicator")){this.byId("messagesIndicator").setVisible(false);}this.byId("BankServiceMappingViewObjectPageLayout").setShowFooter(false);},onRoutePatternMatched:function(e){if(e.getParameter("name")!=="ServiceMappingScreen"){return;}this.getView().getModel().setDefaultBindingMode("TwoWay");var t=this.getText("SERVICE_OBJECTPAGESECTION_TEXT");this.getOwnerComponent().getService("ShellUIService").then(function(s){s.setTitle(t);},function(E){jQuery.sap.log.error("Cannot get ShellUIService",E,"fin.cash.bankmaster.manage.Component");});this.mode=e.getParameter("arguments").mode.toLowerCase();this.serviceCodePath=e.getParameter("arguments").serviceCodePath;this.bankContextPath=e.getParameter("arguments").bankContextPath;this.bankContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.bankContextPath);this.byId("serviceCodeViewBankGroup").getModel().read("/"+this.bankContextPath);this.byId("serviceCodeViewBankGroup").setBindingContext(this.bankContext);if(this.mode==="create"){this.byId("fin.cash.bankmaster.manage.editButton").setVisible(false);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(true);this.byId("fin.cash.bankmaster.manage.bankfeeServiceSmartForm").setEditable(true);this.serviceCodeContext=this.getView().getModel().createEntry("/BankServiceSet");for(var i in this.serviceCodeContext.getProperty()){if(i!="__metadata"&&this.bankContext.getProperty()[i])this.serviceCodeContext.getProperty()[i]=this.bankContext.getProperty()[i];}this.byId("BankServiceMappingViewObjectPageLayout").setShowFooter(true);}else{if(this.mode==="edit")this._toggleEditAndDisplay(true);else this._toggleEditAndDisplay(false);this.getView().getModel().read("/"+this.serviceCodePath);this.serviceCodeContext=new sap.ui.model.Context(this.getView().getModel(),"/"+this.serviceCodePath);}this.getView().setBindingContext(this.serviceCodeContext);},_toggleEditAndDisplay:function(e){this.byId("fin.cash.bankmaster.manage.editButton").setVisible(!e);this.byId("fin.cash.bankmaster.manage.saveButton").setVisible(e);this.byId("fin.cash.bankmaster.manage.cancelButton").setVisible(e);this.byId("fin.cash.bankmaster.manage.bankfeeServiceSmartForm").setEditable(e);this.byId("BankServiceMappingViewObjectPageLayout").setShowFooter(e);},onSaveButtonPressed:function(){this.dataObject=this.getView().getBindingContext().getObject();this.dataObject.BankInternalId=this.bankContext.getProperty("BankInternalId");this.dataObject.BankCountry=this.bankContext.getProperty("BankCountry");this.saveSuccess=false;this.validatedMessages=[];var i=4;if(this.mode==="create"){var n=true;n=V._setNonEmptyValidation(this,"BankFeeService",this.getText("NON_EMPTY_VALIDATION_BANK_FEE"))&&n;n=V._setNonEmptyValidation(this,"PaymentTransactionTypeGroup",this.getText("NON_EMPTY_VALIDATION_TRANSACTION_TYPE"))&&n;n=V._setNonEmptyValidation(this,"PaymentExternalTransacType",this.getText("NON_EMPTY_VALIDATION_EXTERNAL_TRANSACTION"))&&n;if(!n){return;}this.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(false);this.byId("fin.cash.bankmaster.manage.saveButton").setText(this.getText("SAVING_BUTTON"));var t=this;$.when(C._createData(this,"/BankServiceSet",this.getText("CREATE_SERVICE_SUCCESS_TEXT"),this.getText("CREATE_SERVICE_ERROR_TEXT"))).then(function(r){if(r){t.byId("fin.cash.bankmaster.manage.saveButton").setEnabled(true);t.byId("fin.cash.bankmaster.manage.saveButton").setText(t.getText("SAVE_BUTTON"));if(t.saveSuccess===true){t.getRouter().navTo("ServiceMappingScreen",{mode:"read",bankContextPath:t.bankContextPath,serviceCodePath:"BankServiceSet(BankCountry='"+t.bankContext.getProperty("BankCountry")+"',BankInternalId='"+encodeURIComponent(t.bankContext.getProperty("BankInternalId"))+"',BankFeeService='"+t.dataObject.BankFeeService+"',PaymentTransactionTypeGroup='"+t.dataObject.PaymentTransactionTypeGroup+"')"},true);}}});}else{U._updateData(this,this.getText("UPDATE_SERVICE_SUCCESS_TEXT"),this.getText("UPDATE_SERVICE_ERROR_TEXT"));this._toggleEditAndDisplay(false);}},onCancelButtonPressed:function(){M._pressCancelButton(this);},onEditButtonPressed:function(e){this._toggleEditAndDisplay(true);},onMessagePopoverPressed:function(){this.byId("messagesIndicator").setVisible(true);this.byId("messagesIndicator").setText(this.validatedMessages.length);this.messagePopover.openBy(this.byId("messagesIndicator"));}});});
